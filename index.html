<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flappy Dove</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #7ecbff; /* sky blue */
    font-family: Arial, sans-serif;
}
canvas { display: block; }

#loginScreen {
    position: absolute;
    width: 100%;
    height: 100%;
    background: #7ecbff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 100;
}
#loginScreen input {
    padding: 10px;
    font-size: 16px;
    margin-bottom: 10px;
}
#loginScreen button {
    padding: 10px 20px;
    font-size: 16px;
    background: #4caf50;
    color: #fff;
    border: none;
    cursor: pointer;
}
#loginScreen button:hover { background: #45a049; }

#loginScreen label {
    font-size: 16px;
    margin-bottom: 10px;
}

#leaderboard {
    position:absolute; top:10px; right:10px; 
    background:#fff; padding:10px; 
    max-width:150px;
    font-size:14px;
}
</style>
</head>
<body>

<div id="loginScreen">
    <h2>Flappy Dove Login</h2>
    <input type="text" id="username" placeholder="Enter your username" />
    <label><input type="checkbox" id="hardMode"> Hard Mode (type to flap)</label>
    <button onclick="login()">Start Playing</button>
</div>

<canvas id="game"></canvas>
<div id="leaderboard"></div>

<script>
// ==================== Login ====================
const bannedWords = ["badword1","badword2","nigger","shit","fuck","ass"];
let username = '';
let hardMode = false;
let gameStarted = false;

function login(){
    const name = document.getElementById('username').value.trim();
    if(name===''){ alert('Please enter a username!'); return; }

    const lowerName = name.toLowerCase();
    for(let word of bannedWords){
        if(lowerName.includes(word)){
            alert('This username is not allowed!');
            return;
        }
    }

    username = name;
    hardMode = document.getElementById('hardMode').checked;
    localStorage.setItem('flappyUsername', username);
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('username').blur();
    gameStarted = true; // start immediately
}

// ==================== Canvas ====================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener("resize", resize);
resize();

// ==================== Game variables ====================
let frames = 0, score = 0, gameOver = false, highScore = Math.min(parseInt(localStorage.getItem("highScore"))||0,80);

// ==================== Grass ====================
const grassHeight = 80;
const grassTufts = [];
const numTufts = 400;
for(let i=0;i<numTufts;i++){
    grassTufts.push({
        x: Math.random()*canvas.width,
        y: canvas.height - grassHeight + Math.random()*grassHeight,
        height: Math.random()*15 + 5,
        color: Math.random() > 0.6 ? "#ffffff" : "#4caf50",
        speed: Math.random()*0.3 + 0.05
    });
}

function drawGrass(){
    ctx.fillStyle = "#2e7d32";
    ctx.fillRect(0, canvas.height - grassHeight, canvas.width, grassHeight);
    grassTufts.forEach(t=>{
        ctx.fillStyle = t.color;
        ctx.fillRect(t.x, t.y - t.height, 2, t.height);
        t.y += Math.sin(frames*0.05 + t.x*0.01)*t.speed;
        if(t.y > canvas.height) t.y = canvas.height - grassHeight;
        if(t.y < canvas.height - grassHeight) t.y = canvas.height - grassHeight + Math.random()*5;
    });
}

// ==================== Bird ====================
const bird = {
    x: ()=> canvas.width*0.18,
    y: canvas.height/2,
    r:12,
    gravity:0.28,
    lift:-6.5,
    vel:0,
    angle:0,
    update(){
        this.vel += this.gravity;
        this.y += this.vel;
        this.angle = Math.max(-0.4, Math.min(this.vel/10,1));
        if(this.y + this.r > canvas.height - grassHeight) gameOver=true;
        if(this.y - this.r < 0){ this.y = this.r; this.vel=0; }
    },
    flap(){ this.vel = this.lift; },
    draw(){
        ctx.save();
        ctx.translate(this.x(), this.y);
        ctx.rotate(this.angle);
        ctx.fillStyle="yellow";
        ctx.beginPath();
        ctx.arc(0,0,this.r,0,Math.PI*2);
        ctx.fill();
        ctx.strokeStyle="#000"; ctx.lineWidth=2;
        ctx.beginPath();
        ctx.moveTo(this.r,0); ctx.lineTo(this.r+16,0);
        ctx.stroke();
        ctx.restore();
    }
};

// ==================== Pipes ====================
const pipes=[];
const gap=180, pipeW=50, pipeSpacing=140;

function addPipe(){
    const maxTop = canvas.height - grassHeight - gap - 40;
    const top = Math.random()*maxTop +30;
    pipes.push({x:canvas.width, top:top, bottom:canvas.height-grassHeight-top-gap, passed:false});
}

function updatePipes(){
    pipes.forEach(p=>{
        p.x -= 2.2;
        if(bird.x()+bird.r > p.x && bird.x()-bird.r < p.x+pipeW &&
           (bird.y-bird.r < p.top || bird.y+bird.r > canvas.height-grassHeight - p.bottom)){
            gameOver=true;
        }
        if(!p.passed && p.x+pipeW < bird.x()){
            score++; p.passed=true;
            if(score>highScore){ highScore=Math.min(score,80); localStorage.setItem("highScore",highScore);}
        }
    });
    if(pipes.length && pipes[0].x + pipeW <0) pipes.shift();
    if(frames%pipeSpacing===0) addPipe();
}

// ==================== UI ====================
function drawUI(){
    ctx.fillStyle="#000";
    ctx.font="18px Arial";
    ctx.fillText(`Player: ${username}`,20,70);
    ctx.fillText(`Score: ${score}`,20,32);
    ctx.fillText(`High: ${highScore}/80`,20,52);
    if(gameOver){
        ctx.fillStyle="red"; ctx.font="30px Arial";
        ctx.fillText("Game Over", canvas.width/2-85,canvas.height/2-10);
        ctx.font="16px Arial";
        ctx.fillText(hardMode ? "Type any key to restart" : "Tap anywhere to restart", canvas.width/2-80,canvas.height/2+25);
        saveScore(score);
    }
}

// ==================== Leaderboard ====================
function saveScore(score){
    let leaderboard = JSON.parse(localStorage.getItem('flappyLeaderboard')||'[]');
    leaderboard.push({username,score});
    leaderboard.sort((a,b)=>b.score-a.score);
    leaderboard = leaderboard.slice(0,5);
    localStorage.setItem('flappyLeaderboard', JSON.stringify(leaderboard));
    displayLeaderboard();
}
function displayLeaderboard(){
    const div = document.getElementById('leaderboard');
    div.innerHTML='<h3>Leaderboard</h3>';
    let leaderboard = JSON.parse(localStorage.getItem('flappyLeaderboard')||'[]');
    leaderboard.forEach(item=>{
        const d = document.createElement('div');
        d.textContent = `${item.username}: ${item.score}`;
        div.appendChild(d);
    });
}

// ==================== Loop ====================
function loop(){
    ctx.fillStyle="#7ecbff"; ctx.fillRect(0,0,canvas.width,canvas.height);
    drawGrass();
    if(gameStarted){
        if(!gameOver){ bird.update(); updatePipes(); frames++; }
        ctx.fillStyle="#2e8b57";
        pipes.forEach(p=>{ ctx.fillRect(p.x,0,pipeW,p.top); ctx.fillRect(p.x,canvas.height-grassHeight-p.bottom,pipeW,p.bottom); });
        bird.draw(); drawUI();
    }
    requestAnimationFrame(loop);
}

function resetGame(){ pipes.length=0; bird.y=canvas.height/2; bird.vel=0; score=0; frames=0; gameOver=false; }

// ==================== Controls ====================
function handleFlap(event){
    if(gameOver){ resetGame(); return; }

    if(hardMode){
        if(event.type === "keydown" && event.key.length === 1){ bird.flap(); }
    } else {
        const active = document.activeElement;
        if(active && (active.tagName==="INPUT" || active.tagName==="TEXTAREA")) return;
        bird.flap();
    }
}

document.addEventListener("touchstart", handleFlap, {passive:true});
document.addEventListener("mousedown", handleFlap);
document.addEventListener("keydown", handleFlap);
document.body.addEventListener("click", ()=>{ document.documentElement.requestFullscreen?.(); }, {once:true});

// ==================== Start ====================
document.getElementById('username').focus();
displayLeaderboard();
loop();
</script>

</body>
</html>
